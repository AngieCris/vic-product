
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Deploy a VCH with vSphere Integrated Containers Registry (Harbor) Â· VMware vSphere Integrated Containers Engine 0.8 Installation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="install_vic_plugin.html" />
    
    
    <link rel="prev" href="set_up_ops_user.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    Overview of vSphere Integrated Containers Engine for vSphere Administrators
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="networks.html">
            
                <a href="networks.html">
            
                    
                    Networks Used by vSphere Integrated Containers Engine
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="download_vic.html">
            
                <a href="download_vic.html">
            
                    
                    Download vSphere Integrated Containers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="contents_of_vic_binaries.html">
            
                <a href="contents_of_vic_binaries.html">
            
                    
                    Contents of the vSphere Integrated Containers Engine Binaries
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="deploy_vch.html">
            
                <a href="deploy_vch.html">
            
                    
                    Deploy VCHs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="vic_installation_prereqs.html">
            
                <a href="vic_installation_prereqs.html">
            
                    
                    Environment Prerequisites for VCH Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="deploy_vch_esxi.html">
            
                <a href="deploy_vch_esxi.html">
            
                    
                    Deploy a VCH to an ESXi Host with No vCenter Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="deploy_vch_vcenter.html">
            
                <a href="deploy_vch_vcenter.html">
            
                    
                    Deploy a VCH to a Basic vCenter Server Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="verify_vch_deployment.html">
            
                <a href="verify_vch_deployment.html">
            
                    
                    Verify the Deployment of a VCH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="vch_installer_options.html">
            
                <a href="vch_installer_options.html">
            
                    
                    VCH Deployment Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="vch_installer_examples.html">
            
                <a href="vch_installer_examples.html">
            
                    
                    Advanced Examples of Deploying a VCH
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="set_up_ops_user.html">
            
                <a href="set_up_ops_user.html">
            
                    
                    Use Different User Accounts for VCH Deployment and Operation
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.8" data-path="deploy_vch_harbor.html">
            
                <a href="deploy_vch_harbor.html">
            
                    
                    Deploy a VCH with vSphere Integrated Containers Registry (Harbor)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="install_vic_plugin.html">
            
                <a href="install_vic_plugin.html">
            
                    
                    Installing the vSphere Web Client Plug-in
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="plugin_vc_web.html">
            
                <a href="plugin_vc_web.html">
            
                    
                    vCenter Server For Windows with a Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="plugin_vc_no_web.html">
            
                <a href="plugin_vc_no_web.html">
            
                    
                    vCenter Server for Windows without a Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="plugin_vcsa_web.html">
            
                <a href="plugin_vcsa_web.html">
            
                    
                    vCenter Server Appliance with a Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="plugin_vcsa_no_web.html">
            
                <a href="plugin_vcsa_no_web.html">
            
                    
                    vCenter Server Appliance without a Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="plugin_verify_deployment.html">
            
                <a href="plugin_verify_deployment.html">
            
                    
                    Verify the Deployment of the Plug-In
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="troubleshoot_vic_install.html">
            
                <a href="troubleshoot_vic_install.html">
            
                    
                    Troubleshooting vSphere Integrated Containers Engine Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="ts_vch_deployment_timeout.html">
            
                <a href="ts_vch_deployment_timeout.html">
            
                    
                    VCH Deployment Times Out
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="ts_thumbprint_error.html">
            
                <a href="ts_thumbprint_error.html">
            
                    
                    Certificate Verification Error
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="ts_cli_argument_error.html">
            
                <a href="ts_cli_argument_error.html">
            
                    
                    Missing Common Name Error When TLS Options Are Specified
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="ts_firewall_error.html">
            
                <a href="ts_firewall_error.html">
            
                    
                    Firewall Validation Error
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="ts_cname_mismatch.html">
            
                <a href="ts_cname_mismatch.html">
            
                    
                    Certificate cname Mismatch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="ts_ui_not_appearing.html">
            
                <a href="ts_ui_not_appearing.html">
            
                    
                    Plug-In Does Not Appear in the vSphere Web Client
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="ts_docker_version_error.html">
            
                <a href="ts_docker_version_error.html">
            
                    
                    Docker API Version Error
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="ts_docker_api_check_error.html">
            
                <a href="ts_docker_api_check_error.html">
            
                    
                    I/O Timeout Error
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="feedback.html">
            
                <a href="feedback.html">
            
                    
                    Send Documentation Feedback
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Deploy a VCH with vSphere Integrated Containers Registry (Harbor)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="deploy-a-vch-with-vsphere-integrated-containers-registry-harbor">Deploy a VCH with vSphere Integrated Containers Registry (Harbor)</h1>
<p>This example uses vSphere Integrated Containers Engine 0.8.0, Harbor 0.5.0, and Ubuntu on the user machine. Harbor requires 60GB or more free space on your datastore.</p>
<p>If no server certificate and private key are provided during installation, Harbor will create a self-generated CA (certificate authority) certificate, a server certificate, and a server private key.  The self-generated CA certificate will be available for download from the Harbor web client.</p>
<p>See the OVA installation guide for Harbor <a href="https://github.com/vmware/harbor/blob/master/docs/installation_guide_ova.md" target="_blank">Harbor docs</a>. Harbor requires both an IP address and FQDN (fully qualified domain name) for the server. A DHCP install method is available for debugging purposes, but it is not a recommended production deployment model.</p>
<p>This example assumes a Harbor instance was installed without a server certificate or a private key and the CA cert downloaded using the Harbor instructions. For Harbor to work with vSphere Integrated Containers Engine you need to update standard docker with the Harbor CA cert and deploy a new VCH with the CA cert.</p>
<h2 id="update-the-user-working-machines-standard-docker-with-the-harbor-ca-certificate">Update the User Working Machine&apos;s Standard Docker with the Harbor CA Certificate</h2>
<p>Update the machine with standard Docker so it recognizes the CA certificate. Docker can look for additional CA certificates outside of the operating system&apos;s CA bundle folder if the new CA certificates are in the correct location. See <a href="https://docs.docker.com/engine/security/certificates/" target="_blank">Verify repository client with certificates</a>.</p>
<p>Create the necessary folder, copy the CA cert file to the folder. Restart Docker, then verify that you can log onto the Harbor server.</p>
<p><strong>Note</strong> This example has Ubuntu-specific commands.</p>
<pre><code>user@Devbox:~/mycerts$ sudo su
[sudo] password for user: 
root@Devbox:/home/user/mycerts# mkdir -p /etc/docker/certs.d/&lt;Harbor FQDN&gt;
root@Devbox:/home/user/mycerts# mkdir -p /etc/docker/certs.d/&lt;Harbor IP&gt;
root@Devbox:/home/user/mycerts# cp ca.crt /etc/docker/certs.d/&lt;Harbor FQDN&gt;/
root@Devbox:/home/user/mycerts# cp ca.crt /etc/docker/certs.d/&lt;Harbor IP&gt;/
root@Devbox:/home/user/mycerts# exit
exit
user@Devbox:~/mycerts$ sudo systemctl daemon-reload
user@Devbox:~/mycerts$ sudo systemctl restart docker

user@Devbox:~$ docker logout &lt;Harbor FQDN&gt;
Remove login credentials for &lt;Harbor FQDN&gt;
user@Devbox:~$ docker logout &lt;Harbor IP&gt;
Remove login credentials for &lt;Harbor IP&gt;

user@Devbox:~$ docker login &lt;Harbor FQDN&gt;
Username: user
Password: 
Login Succeeded

user@Devbox:~$ docker login &lt;Harbor IP&gt;
Username: user
Password: 
Login Succeeded

user@Devbox:~$ docker logout &lt;Harbor FQDN&gt;
Remove login credentials for &lt;Harbor FQDN&gt;

user@Devbox:~$ docker logout &lt;Harbor IP&gt;
Remove login credentials for &lt;Harbor IP&gt;
</code></pre><p>This example creates folders for both FQDN and IP in the docker cert folder and copies the CA cert to both folders. You can then log into Harbor from Docker using both FQDN and IP address.</p>
<h2 id="install-a-vch-with-the-new-ca-certificate">Install a VCH with the New CA Certificate</h2>
<p>Deploy a VCH and specify the CA cert with <code>--registry-ca</code> parameter in vic-machine.  This parameter is a list, and you can easily add multiple CA certs by specifying multiple <code>--registry-ca</code> parameters.</p>
<p>For simplicity, this example installs a VCH with the <code>--no-tls</code> flag, so you do not need TLS from a docker CLI to the VCH. However, it does not imply that access to Harbor is performed without TLS.</p>
<pre>
./vic-machine-linux create 
--target=<vcenter_ip> 
--image-store=&quot;vsanDatastore&quot; 
--name=vic-docker 
--user=root 
--password=<vcenter_password> 
--compute-resource=&quot;/dc1/host/cluster1/Resources&quot; 
--bridge-network DPortGroup 
--force 
--no-tls 
--registry-ca=ca.crt

 WARN[2016-11-11T11:46:37-08:00] Configuring without TLS 
- all communications will be insecure
 ...

 INFO[2016-11-11T11:47:57-08:00] Installer completed successfully</vcenter_password></vcenter_ip></pre>            
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="set_up_ops_user.html" class="navigation navigation-prev " aria-label="Previous page: Use Different User Accounts for VCH Deployment and Operation">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="install_vic_plugin.html" class="navigation navigation-next " aria-label="Next page: Installing the vSphere Web Client Plug-in">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Deploy a VCH with vSphere Integrated Containers Registry (Harbor)","level":"1.4.8","depth":2,"next":{"title":"Installing the vSphere Web Client Plug-in","level":"1.5","depth":1,"path":"install_vic_plugin.md","ref":"install_vic_plugin.md","articles":[{"title":"vCenter Server For Windows with a Web Server","level":"1.5.1","depth":2,"path":"plugin_vc_web.md","ref":"plugin_vc_web.md","articles":[]},{"title":"vCenter Server for Windows without a Web Server","level":"1.5.2","depth":2,"path":"plugin_vc_no_web.md","ref":"plugin_vc_no_web.md","articles":[]},{"title":"vCenter Server Appliance with a Web Server","level":"1.5.3","depth":2,"path":"plugin_vcsa_web.md","ref":"plugin_vcsa_web.md","articles":[]},{"title":"vCenter Server Appliance without a Web Server","level":"1.5.4","depth":2,"path":"plugin_vcsa_no_web.md","ref":"plugin_vcsa_no_web.md","articles":[]},{"title":"Verify the Deployment of the Plug-In","level":"1.5.5","depth":2,"path":"plugin_verify_deployment.md","ref":"plugin_verify_deployment.md","articles":[]}]},"previous":{"title":"Use Different User Accounts for VCH Deployment and Operation","level":"1.4.7","depth":2,"path":"set_up_ops_user.md","ref":"set_up_ops_user.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageBreaksBefore":"/","headerTemplate":"_TITLE_","paperSize":"a4","margin":{"right":62,"left":62,"top":56,"bottom":56},"fontSize":12,"fontFamily":"Arial","footerTemplate":"_PAGENUM_  -  Last updated 2017-02-23","chapterMark":"pagebreak","pageNumbers":true},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"VMware vSphere Integrated Containers Engine 0.8 Installation","gitbook":"3.x.x"},"file":{"path":"deploy_vch_harbor.md","mtime":"2017-02-23T09:53:04.750Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-02-23T13:27:32.713Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

